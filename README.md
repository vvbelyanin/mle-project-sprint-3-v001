
## Спринт 4/10 → Тема 5/6: Проект на тему "Релиз модели в продакшн"

##### Описание задачи
Вывод в продакшн разработанной на предыдущих этапах модели для Яндекс Недвижимости, маркетплейсе для аренды и покупки жилой и коммерческой недвижимости. 

##### Бизнес-задачи
- Разработка онлайн-сервиса для предсказания модели цены на недвижимось    
- Обеспечение кроссплатформенности сервиса для работы с другими сервисами компании    
- Настройка мониторинга работы сервиса для своевременного извещения о потенциальных рисках

##### Задачи инженера машинного обучения
- Разработка FastAPI микросервиса
- Контейнеризация микросервиса с помощью Docker
- Развертывание системы мониторинга с использованием Prometheus и Grafana
- Настройка дашборда для мониторинга в Grafana

##### Используемые инструменты
- Visual Studio Code
- FastAPI, uvicorn
- Docker и Docker Compose
- Prometheus
- Grafana
- Python-библиотеки для экспортёров: prometheus_client, prometheus_fastapi_instrumentator.

### План выполнения проекта

#### Этап 1. Написание FastAPI-микросервиса
- Программирование микросервиса, принимающего входные данные и выдающего предсказания модели в формате JSON, используя FastAPI и uvicorn
- Разработка класса-обработчика с функциями валидации входных данных, и возвращающего предсказания
- Заполнение файла requirements.txt
- Написание инструкции в Instructions.md для установки и запуска микросервиса с использованием виртуального окружения
- Добавление примера curl-запросов

##### Результаты этапа 1
- Код микросервиса в app, модель в models, requirements.txt
- Instructions.md по запуску FastAPI-микросервиса
- Swagger на странице /docs должен быть пример запроса

#### Этап 2. Контейнеризация микросервиса
- Настройка Dockerfile для сборки образа сервиса
- Настройка docker-compose.yaml для запуска сервиса в режиме Docker Compose
- Написание инструкции по запуску микросервиса с помощью команд docker image и docker container
- Написание инструкции по запуску микросервиса в режиме Docker Compose
- Добавление примера запроса, который микросервис обработает корректно

##### Результаты этапа 2
- Dockerfile для сборки образа FastAPI-микросервиса
- docker-compose.yaml для сборки контейнера микросервиса
- Instructions.md с командами `docker image`+`docker container` и `docker compose` с примером запроса, который микросервис обработает корректно

#### Этап 3. Запуск сервисов для системы мониторинга
- Добавление в `docker compose` описание сервиса Prometheus
- Добавление файла конфигурации prometheus.yml, который  подключается в качестве тома в Docker
- Добавление в `docker compose` описание сервиса Grafana
- Добавьте в микросервис экспортёр с помощью `prometheus_fastapi_instrumentator`
- Написание инструкции по запуску микросервиса и системы мониторинга в режиме `docker compose`

##### Результаты этапа 3
- Файл docker-compose-stage-3.yaml, в котором теперь присутствует описание сервисов Prometheus и Grafana
- Заполненный prometheus.yml
- Файл с микросервисом app-stage-3.py, в котором теперь присутствует запуск экспортёра с помощью `prometheus_fastapi_instrumentator`
- Instructions.md с указанием адресов микросервиса, Prometheus, Grafana

#### Этап 4. Построение дашборда для мониторинга
- Описание в файле Monitoring.md используемых ML-метрик реального времени,  также инфраструктурного и прикладного уровней для мониторинга приложения
- Добавление метрик разного типа с помощью `prometheus_client` в FastAPI-приложение
- Напиcание .py-скрипта для симуляции нагрузки на сервис и добавление инструкцию по его запуску
- Построение дашборда в Grafana
- Сохранение дашборда в JSON-файл с названием dashboard.json и его загрузка в Git
- Добавление скриншота дашборда и его описания в Monitoring.md

##### Результаты этапа 4
- Описание в файле Monitoring.md выбранных метрик и обоснование их выбора
- Инструкция в файле Instructions.md запуску скрипта, симулирующего нагрузку на сервис
- Описание дашборда в файле Monitoring.md
- Файл с дашбордом dashboard.json

### Итоги проекта и общие выводы
- Была поставлена задача разработки онлайн-сервиса для предсказания модели цены на недвижимось    
- Были определены основные характеристики микросервиса: кроссплатформенность, мониторинг, вывод в продакшн
- Основной код - Python, основной формат конфигураций - YAML
- Для достижения кроссплатформенности использованы инструменты FastAPI и Docker
- Системы мониторинга выстроена с помощью Prometheus и Grafana
- Выбранные инструменты и платформы позволяют выполнить поставленные задачи без избыточного кода, настройки сервисов задаются в простых переносимых форматах
- Проведены валидационные тесты работы микросервиса
- Настроенный мониторинг позволяет отслеживать основные метрики на прикладном и инфраструктурном уровнях
- Дальнейшее усовершенствование микросервиса зависит от масштабов и параметров ввода сервиса в продакшн, а также от аппаратных ресурсов, которые все вместе, возможно, потребуют донастройки используемых инструментов, но на базе данного проекта это является выполнимой рабочей задачей
